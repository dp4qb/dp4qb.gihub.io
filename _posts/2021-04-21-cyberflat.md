---
title: "Кибероднушка-0"
date: 2021-04-21T12:00:00+04:00
categories:
  - cyberflat
---

Как я автоматизировал свет и перестал биться мизинцем о комод. Часть нулевая, вводная.
{: .text-right}
{: .notice}

Короче, я сделал дом умнее: свет, шторы и температура управляются голосом, датчиками, автоматизациями и приложением. Собираю данные по температуре, влажности, освещенности, энерго- и водопотеблению. Отказоустойчиво до потери питания. Жить удобно.
{: .text-justify}

![image-center](/assets/images/cyberflat_0_belissimo.jpg){: .align-center}

## Но зачем?
Заниматься системами безумного дома я хотел довольно давно - класса с восьмого. Это ещё когда все такие системы были на промышленных контроллерах и линиями связи в стенах. Централизованно, цементировано, надёжно и диоды. Уверен, что они работают по сей день и будут потом. С того времени уже не один раз сменился подход ко всякого рода автоматизациям -- паять и прогать уже не обязательно, стены можно не штробить, Китай штампует недорогие устройства "включил-забыл" вагонами. 
{: .text-justify}

Да и [SLA](https://dev.to/zex/sli-slo-and-sla-12bp) таких систем может быть от five nines до nine fives, лишь бы выполнялся [wife approval factor](https://en.wikipedia.org/wiki/Wife_acceptance_factor), т.е. глаз не должен цепляться. Идеальный кандидат для хобби на несколько вечеров. А ещё вышла замечательная статья Вастрика про [домдурачок](https://vas3k.ru/blog/homesillyhome/), так что откладывать было уже нельзя.
{: .text-justify}

Хотелось просто поиграться и понять, что вообще нынче можно пихнуть в однушку, чтобы стало легче жить, а если не подойдет - продать на Авито или отдать коллегам. У меня не было какого-то чёткого плана, что и как я хочу получить, поэтому все, что сложнее plug-and-play не подошло. Чистовая отделка уже была, а делать ремонт ради закладывания двух-трех линий слаботочки едва ли возбуждало.
{: .text-justify}

Что делать? Облучаться - wifi, bluetooth, zigbee. И ещё как-нибудь так, чтобы не остаться в темноте без интернета (достаточно облучившись можно этого и не бояться). Да и не только без света - так как у нас тут наколеночный agile, системы безопасности (умные замки, дым/газ/контроллеры 220+) решил не ставить. Потом немного осмелел, но до замков так и не добрался, и пока не хочу.
{: .text-justify}

## И что, без проблем?
**Первая** - надежность. Интернет иногда выключается. Вайфай иногда глючит. Китайское облако иногда роскомпозорят. Даже умные кормушки иногда взламывают. Это уже история про управление рисками. Надежность упростил до принципа эскалатора: если эскалатор не едет, он становится лестницей. Случилось что-то из списка выше - лампочки выключаются выключателем, как в старые добрые времена. Жить становится *терпимо*. 
{: .text-justify}

Благо, по дому можно ровным слоем размазать устройства разных вендоров. Но тут по спине хлопает невидимая рука рынка - и это **вторая** проблема. Каждый производитель пытается затащить в свою экосистему, чтобы ты покупал только их устройства, и работают они только со своими облаками. Такой легион wannabe-эплов в мире умных лампочек. У одного только Сяоми три разных бренда умных вещей, которые крайне плохо друг с другом дружат. С одной стороны, нет недостатка в разнообразии устройств у крупных брендов, но если чего-то нет в их магазине - ну, дружок, мы считаем что тебе оно и не надо. 
{: .text-justify}

Это значит, что об автоматизации всей квартиры можно думать только намазав её устройствами одного вендора: лампочка xiaomi не будет реагировать на сигналы датчика philips hue, и наоборот. Загнуся стартапчик умных кофеваорк, облако отключили - меняй все или переезжай. Захотел чего-то эдакого, чего у бренда нет - покупаешь у соседей, вместе с очередным хабом и новым приложением. Никакой единой точки управления. Просто покупаешь бюджетный сматрфон и ходишь с ним по дому, чтобы свет включать. Можно даже в пакетик его упаковать, чтобы не марался. Отвратительно.
{: .text-justify}

![image-center](/assets/images/cyberflat_0_e.jpg){: .align-center}


## Как жить?
Сводить всё в одно место. Для меня таким местом стал [home assistant](https://www.home-assistant.io/), работающий в домашней сети. Всеми устройствами он управляет локально, так что при отрыве интернета все продолжает шуршать. Он доступен из интернета, чтобы устраивать коту светомузыку из маршрутки. Ещё это нужно для интеграций облаков с домом, но об этом чуть позже. 
{: .text-justify}


## Не ляжет?
Home Assistant берет на себя роль "универсального хаба", который общается со всеми устройствами через интеграции и управляет ими для единых автоматизаций. Такой вот универсальный кросс-вендорный хаб. Всеми устройствами, которые поддерживают локальное управление, он старается управлять локально. Так же он рулит zigbee-устройствами без шлюза, и теми устройствами, которые умеют в mqtt. Если выключется HAss, перестанут работать все кросс-вендорные автоматизации и то, что не умеет в облака. Например, включение/выключение света датчиком движения - датчики локальные, а лампочки привязаны к облаку.
{: .text-justify}

Останется управление через облако производителя, и его интеграций с другими облаками. Например, управление светом из Яндекс.Станции или Капсулы будет работать на всех лампочках, а вот умными кнопками, которые я приклеил в самых удобных местах, управлять уже не получится. Отвалится блок автоматизаций с датчиками движения, потому что датчики безоблачные. Но будет работать моя любимая автоматизация - по голосовой команде "Союз нерушимый" весь свет в квартире переключается на торжественно-красный и включается гимн СССР. Ильич, вставай!
{: .text-justify}


## А дальше-то что?
Я пока где-то в середине пути. Но для себя я понял, что оценить любой умный дом довольно просто. Как вообще понять, что умный дом удался? Если его не замечаешь. А если замечаешь его отсутствие - то моё почтение, он хорош. Я пробовал разные штуки, которые мне казались интересными. Какие-то прижились, а какие-то нет. Например, автоматическая подстройка освещения в зависимости от времени суток работала хорошо, но не всегда свет подходил ситуации. Это было заметно и выглядело неестествено. Точно так же, как и климат-контроль с обратной связью от датчиков. Все это будет работать зашибенно, когда система сможет реагировать на события "мне темно" или "мне холодно", на neural link например. Но пока что этого нет, и мне приходится писать ифики. Обратный машин лёрнинг какой-то.
{: .text-justify}

И вот про такие эксперименты я и буду потихоньку писать. Stay tuna!
{: .text-justify}
